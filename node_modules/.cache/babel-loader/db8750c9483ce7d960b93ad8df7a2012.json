{"remainingRequest":"C:\\dev\\farming-forum\\node_modules\\babel-loader\\lib\\index.js!C:\\dev\\farming-forum\\node_modules\\eslint-loader\\index.js??ref--14-0!C:\\dev\\farming-forum\\src\\store\\modules\\threads.js","dependencies":[{"path":"C:\\dev\\farming-forum\\src\\store\\modules\\threads.js","mtime":1639942079112},{"path":"C:\\dev\\farming-forum\\babel.config.js","mtime":1638558199793},{"path":"C:\\dev\\farming-forum\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\dev\\farming-forum\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\dev\\farming-forum\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIkM6XFxkZXZcXGZhcm1pbmctZm9ydW1cXG5vZGVfbW9kdWxlc1xcQGJhYmVsXFxydW50aW1lXFxoZWxwZXJzXFxlc21cXGFzeW5jVG9HZW5lcmF0b3IuanMiOwppbXBvcnQgX29iamVjdFNwcmVhZCBmcm9tICJDOlxcZGV2XFxmYXJtaW5nLWZvcnVtXFxub2RlX21vZHVsZXNcXEBiYWJlbFxccnVudGltZVxcaGVscGVyc1xcZXNtXFxvYmplY3RTcHJlYWQyLmpzIjsKaW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUuanMiOwppbXBvcnQgeyBhcnJheVVuaW9uLCBjb2xsZWN0aW9uLCBkb2MsIGdldERvYywgc2VydmVyVGltZXN0YW1wLCB3cml0ZUJhdGNoIH0gZnJvbSAiZmlyZWJhc2UvZmlyZXN0b3JlIjsKaW1wb3J0IHsgZG9jVG9SZXNvdXJjZSwgZmluZEJ5SWQsIG1ha2VBcHBlbmRDaGlsZFRvUGFyZW50TXV0YXRpb24gfSBmcm9tICdAL2hlbHBlcnMnOwppbXBvcnQgeyBkYiB9IGZyb20gJy4uLy4uL21haW4nOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZXNwYWNlZDogdHJ1ZSwKICBzdGF0ZTogewogICAgaXRlbXM6IFtdCiAgfSwKICBnZXR0ZXJzOiB7CiAgICB0aHJlYWQ6IGZ1bmN0aW9uIHRocmVhZChzdGF0ZSwgZ2V0dGVycywgcm9vdFN0YXRlKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoaWQpIHsKICAgICAgICB2YXIgdGhyZWFkID0gZmluZEJ5SWQoc3RhdGUuaXRlbXMsIGlkKTsKICAgICAgICBpZiAoIXRocmVhZCkgcmV0dXJuIHt9OwogICAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIHRocmVhZCksIHt9LCB7CiAgICAgICAgICBnZXQgYXV0aG9yKCkgewogICAgICAgICAgICByZXR1cm4gZmluZEJ5SWQocm9vdFN0YXRlLnVzZXJzLml0ZW1zLCB0aHJlYWQudXNlcklkKTsKICAgICAgICAgIH0sCgogICAgICAgICAgZ2V0IHJlcGxpZXNDb3VudCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRocmVhZC5wb3N0cy5sZW5ndGggLSAxOwogICAgICAgICAgfSwKCiAgICAgICAgICBnZXQgY29udHJpYnV0b3JzQ291bnQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aHJlYWQuY29udHJpYnV0b3JzLmxlbmd0aDsKICAgICAgICAgIH0KCiAgICAgICAgfSk7CiAgICAgIH07CiAgICB9CiAgfSwKICBhY3Rpb25zOiB7CiAgICBjcmVhdGVUaHJlYWQ6IGZ1bmN0aW9uIGNyZWF0ZVRocmVhZChfcmVmLCBfcmVmMikgewogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICAgIHZhciBjb21taXQsIHN0YXRlLCBkaXNwYXRjaCwgcm9vdFN0YXRlLCB0ZXh0LCB0aXRsZSwgZm9ydW1JZCwgdXNlcklkLCBwdWJsaXNoZWRBdCwgYmF0Y2gsIHRocmVhZFJlZiwgdGhyZWFkLCB1c2VyUmVmLCBmb3J1bVJlZiwgbmV3VGhyZWFkOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvbW1pdCA9IF9yZWYuY29tbWl0LCBzdGF0ZSA9IF9yZWYuc3RhdGUsIGRpc3BhdGNoID0gX3JlZi5kaXNwYXRjaCwgcm9vdFN0YXRlID0gX3JlZi5yb290U3RhdGU7CiAgICAgICAgICAgICAgICB0ZXh0ID0gX3JlZjIudGV4dCwgdGl0bGUgPSBfcmVmMi50aXRsZSwgZm9ydW1JZCA9IF9yZWYyLmZvcnVtSWQ7CiAgICAgICAgICAgICAgICB1c2VySWQgPSByb290U3RhdGUuYXV0aC5hdXRoSWQ7CiAgICAgICAgICAgICAgICBwdWJsaXNoZWRBdCA9IHNlcnZlclRpbWVzdGFtcCgpOwogICAgICAgICAgICAgICAgYmF0Y2ggPSB3cml0ZUJhdGNoKGRiKTsKICAgICAgICAgICAgICAgIHRocmVhZFJlZiA9IGRvYyhjb2xsZWN0aW9uKGRiLCAidGhyZWFkcyIpKTsKICAgICAgICAgICAgICAgIHRocmVhZCA9IHsKICAgICAgICAgICAgICAgICAgZm9ydW1JZDogZm9ydW1JZCwKICAgICAgICAgICAgICAgICAgdGl0bGU6IHRpdGxlLAogICAgICAgICAgICAgICAgICBwdWJsaXNoZWRBdDogcHVibGlzaGVkQXQsCiAgICAgICAgICAgICAgICAgIHVzZXJJZDogdXNlcklkLAogICAgICAgICAgICAgICAgICBpZDogdGhyZWFkUmVmLmlkCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgdXNlclJlZiA9IGRvYyhkYiwgInVzZXJzIiwgdXNlcklkKTsKICAgICAgICAgICAgICAgIGZvcnVtUmVmID0gZG9jKGRiLCAiZm9ydW1zIiwgZm9ydW1JZCk7CiAgICAgICAgICAgICAgICBiYXRjaC5zZXQodGhyZWFkUmVmLCB0aHJlYWQpOwogICAgICAgICAgICAgICAgYmF0Y2gudXBkYXRlKHVzZXJSZWYsIHsKICAgICAgICAgICAgICAgICAgdGhyZWFkczogYXJyYXlVbmlvbih0aHJlYWRSZWYuaWQpCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGJhdGNoLnVwZGF0ZShmb3J1bVJlZiwgewogICAgICAgICAgICAgICAgICB0aHJlYWRzOiBhcnJheVVuaW9uKHRocmVhZFJlZi5pZCkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDE0OwogICAgICAgICAgICAgICAgcmV0dXJuIGJhdGNoLmNvbW1pdCgpOwoKICAgICAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDE2OwogICAgICAgICAgICAgICAgcmV0dXJuIGdldERvYyh0aHJlYWRSZWYpOwoKICAgICAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICAgICAgbmV3VGhyZWFkID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICAgIGNvbW1pdCgnc2V0SXRlbScsIHsKICAgICAgICAgICAgICAgICAgcmVzb3VyY2U6ICd0aHJlYWRzJywKICAgICAgICAgICAgICAgICAgaXRlbTogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBuZXdUaHJlYWQuZGF0YSgpKSwge30sIHsKICAgICAgICAgICAgICAgICAgICBpZDogbmV3VGhyZWFkLmlkCiAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgIHJvb3Q6IHRydWUKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgY29tbWl0KCd1c2Vycy9hcHBlbmRUaHJlYWRUb1VzZXInLCB7CiAgICAgICAgICAgICAgICAgIHBhcmVudElkOiB1c2VySWQsCiAgICAgICAgICAgICAgICAgIGNoaWxkSWQ6IHRocmVhZFJlZi5pZAogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICByb290OiB0cnVlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGNvbW1pdCgnZm9ydW1zL2FwcGVuZFRocmVhZFRvRm9ydW0nLCB7CiAgICAgICAgICAgICAgICAgIHBhcmVudElkOiBmb3J1bUlkLAogICAgICAgICAgICAgICAgICBjaGlsZElkOiB0aHJlYWRSZWYuaWQKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgcm9vdDogdHJ1ZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBkaXNwYXRjaCgncG9zdHMvY3JlYXRlUG9zdCcsIHsKICAgICAgICAgICAgICAgICAgdGV4dDogdGV4dCwKICAgICAgICAgICAgICAgICAgdGhyZWFkSWQ6IHRocmVhZFJlZi5pZAogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICByb290OiB0cnVlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIGZpbmRCeUlkKHJvb3RTdGF0ZS50aHJlYWRzLml0ZW1zLCB0aHJlYWRSZWYuaWQpKTsKCiAgICAgICAgICAgICAgY2FzZSAyMjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUpOwogICAgICB9KSkoKTsKICAgIH0sCiAgICB1cGRhdGVUaHJlYWQ6IGZ1bmN0aW9uIHVwZGF0ZVRocmVhZChfcmVmMywgX3JlZjQpIHsKICAgICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoKSB7CiAgICAgICAgdmFyIGNvbW1pdCwgc3RhdGUsIHJvb3RTdGF0ZSwgdGl0bGUsIHRleHQsIGlkLCB0aHJlYWQsIHBvc3QsIG5ld1RocmVhZCwgbmV3UG9zdCwgdGhyZWFkUmVmLCBwb3N0UmVmLCBiYXRjaDsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29tbWl0ID0gX3JlZjMuY29tbWl0LCBzdGF0ZSA9IF9yZWYzLnN0YXRlLCByb290U3RhdGUgPSBfcmVmMy5yb290U3RhdGU7CiAgICAgICAgICAgICAgICB0aXRsZSA9IF9yZWY0LnRpdGxlLCB0ZXh0ID0gX3JlZjQudGV4dCwgaWQgPSBfcmVmNC5pZDsKICAgICAgICAgICAgICAgIHRocmVhZCA9IGZpbmRCeUlkKHN0YXRlLml0ZW1zLCBpZCk7CiAgICAgICAgICAgICAgICBwb3N0ID0gZmluZEJ5SWQocm9vdFN0YXRlLnBvc3RzLml0ZW1zLCB0aHJlYWQucG9zdHNbMF0pOwogICAgICAgICAgICAgICAgbmV3VGhyZWFkID0gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCB0aHJlYWQpLCB7fSwgewogICAgICAgICAgICAgICAgICB0aXRsZTogdGl0bGUKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgbmV3UG9zdCA9IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgcG9zdCksIHt9LCB7CiAgICAgICAgICAgICAgICAgIHRleHQ6IHRleHQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdGhyZWFkUmVmID0gZG9jKGRiLCAndGhyZWFkcycsIGlkKTsKICAgICAgICAgICAgICAgIHBvc3RSZWYgPSBkb2MoZGIsICdwb3N0cycsIHBvc3QuaWQpOwogICAgICAgICAgICAgICAgYmF0Y2ggPSB3cml0ZUJhdGNoKGRiKTsKICAgICAgICAgICAgICAgIGJhdGNoLnVwZGF0ZSh0aHJlYWRSZWYsIG5ld1RocmVhZCk7CiAgICAgICAgICAgICAgICBiYXRjaC51cGRhdGUocG9zdFJlZiwgbmV3UG9zdCk7CiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDEzOwogICAgICAgICAgICAgICAgcmV0dXJuIGJhdGNoLmNvbW1pdCgpOwoKICAgICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxNTsKICAgICAgICAgICAgICAgIHJldHVybiBnZXREb2ModGhyZWFkUmVmKTsKCiAgICAgICAgICAgICAgY2FzZSAxNToKICAgICAgICAgICAgICAgIG5ld1RocmVhZCA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxODsKICAgICAgICAgICAgICAgIHJldHVybiBnZXREb2MocG9zdFJlZik7CgogICAgICAgICAgICAgIGNhc2UgMTg6CiAgICAgICAgICAgICAgICBuZXdQb3N0ID0gX2NvbnRleHQyLnNlbnQ7CiAgICAgICAgICAgICAgICBjb21taXQoJ3NldEl0ZW0nLCB7CiAgICAgICAgICAgICAgICAgIHJlc291cmNlOiAndGhyZWFkcycsCiAgICAgICAgICAgICAgICAgIGl0ZW06IG5ld1RocmVhZAogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICByb290OiB0cnVlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGNvbW1pdCgnc2V0SXRlbScsIHsKICAgICAgICAgICAgICAgICAgcmVzb3VyY2U6ICdwb3N0cycsCiAgICAgICAgICAgICAgICAgIGl0ZW06IG5ld1Bvc3QKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgcm9vdDogdHJ1ZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgZG9jVG9SZXNvdXJjZShuZXdUaHJlYWQpKTsKCiAgICAgICAgICAgICAgY2FzZSAyMjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMik7CiAgICAgIH0pKSgpOwogICAgfSwKICAgIGZldGNoVGhyZWFkOiBmdW5jdGlvbiBmZXRjaFRocmVhZChfcmVmNSwgX3JlZjYpIHsKICAgICAgdmFyIGRpc3BhdGNoID0gX3JlZjUuZGlzcGF0Y2g7CiAgICAgIHZhciBpZCA9IF9yZWY2LmlkOwogICAgICByZXR1cm4gZGlzcGF0Y2goJ2ZldGNoSXRlbScsIHsKICAgICAgICBlbW9qaTogJ/Cfk4QnLAogICAgICAgIHJlc291cmNlOiAndGhyZWFkcycsCiAgICAgICAgaWQ6IGlkCiAgICAgIH0sIHsKICAgICAgICByb290OiB0cnVlCiAgICAgIH0pOwogICAgfSwKICAgIGZldGNoVGhyZWFkczogZnVuY3Rpb24gZmV0Y2hUaHJlYWRzKF9yZWY3LCBfcmVmOCkgewogICAgICB2YXIgZGlzcGF0Y2ggPSBfcmVmNy5kaXNwYXRjaDsKICAgICAgdmFyIGlkcyA9IF9yZWY4LmlkczsKICAgICAgcmV0dXJuIGRpc3BhdGNoKCdmZXRjaEl0ZW1zJywgewogICAgICAgIHJlc291cmNlOiAndGhyZWFkcycsCiAgICAgICAgaWRzOiBpZHMsCiAgICAgICAgZW1vamk6ICfwn5OEJwogICAgICB9LCB7CiAgICAgICAgcm9vdDogdHJ1ZQogICAgICB9KTsKICAgIH0KICB9LAogIG11dGF0aW9uczogewogICAgYXBwZW5kUG9zdFRvVGhyZWFkOiBtYWtlQXBwZW5kQ2hpbGRUb1BhcmVudE11dGF0aW9uKHsKICAgICAgcGFyZW50OiAndGhyZWFkcycsCiAgICAgIGNoaWxkOiAncG9zdHMnCiAgICB9KSwKICAgIGFwcGVuZENvbnRyaWJ1dG9yVG9UaHJlYWQ6IG1ha2VBcHBlbmRDaGlsZFRvUGFyZW50TXV0YXRpb24oewogICAgICBwYXJlbnQ6ICd0aHJlYWRzJywKICAgICAgY2hpbGQ6ICdjb250cmlidXRvcnMnCiAgICB9KQogIH0KfTs="},{"version":3,"sources":["C:/dev/farming-forum/src/store/modules/threads.js"],"names":["arrayUnion","collection","doc","getDoc","serverTimestamp","writeBatch","docToResource","findById","makeAppendChildToParentMutation","db","namespaced","state","items","getters","thread","rootState","id","author","users","userId","repliesCount","posts","length","contributorsCount","contributors","actions","createThread","commit","dispatch","text","title","forumId","auth","authId","publishedAt","batch","threadRef","userRef","forumRef","set","update","threads","newThread","resource","item","data","root","parentId","childId","threadId","updateThread","post","newPost","postRef","fetchThread","emoji","fetchThreads","ids","mutations","appendPostToThread","parent","child","appendContributorToThread"],"mappings":"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","sourcesContent":["import {arrayUnion, collection, doc, getDoc, serverTimestamp, writeBatch} from \"firebase/firestore\"\r\nimport { docToResource, findById, makeAppendChildToParentMutation } from '@/helpers'\r\n\r\nimport { db } from '../../main'\r\n\r\nexport default {\r\n  namespaced: true,\r\n  state: {\r\n    items: [] \r\n  },\r\n  getters: {\r\n    thread: (state, getters, rootState) => {\r\n\r\n      return (id) => {\r\n  \r\n        const thread = findById(state.items, id)\r\n        if (!thread) return {}\r\n        return { \r\n          ...thread,\r\n          get author () {\r\n            return findById(rootState.users.items, thread.userId)\r\n          },\r\n          get repliesCount () {\r\n            return thread.posts.length - 1\r\n          },\r\n          get contributorsCount () {\r\n            return thread.contributors.length\r\n          }\r\n        }  \r\n      }\r\n    }\r\n  },\r\n  actions: {\r\n    async createThread({commit, state, dispatch, rootState}, {text, title, forumId}) {\r\n      const userId = rootState.auth.authId\r\n      const publishedAt = serverTimestamp()\r\n      const batch = writeBatch(db)\r\n      const threadRef = doc(collection(db, \"threads\"))\r\n      const thread = { forumId, title, publishedAt, userId, id: threadRef.id }\r\n      const userRef = doc(db, \"users\", userId)\r\n      const forumRef = doc(db, \"forums\", forumId)\r\n      batch.set(threadRef, thread)\r\n      batch.update(userRef, {\r\n        threads: arrayUnion(threadRef.id)\r\n      })\r\n      batch.update(forumRef, {\r\n        threads: arrayUnion(threadRef.id)\r\n      })\r\n      await batch.commit()\r\n      const newThread = await getDoc(threadRef)\r\n      commit('setItem', { resource: 'threads', item: {...newThread.data(), id: newThread.id}}, {root: true})\r\n      commit('users/appendThreadToUser', { parentId: userId, childId: threadRef.id }, {root: true})\r\n      commit('forums/appendThreadToForum', { parentId: forumId, childId: threadRef.id }, {root: true})\r\n      dispatch('posts/createPost', { text, threadId: threadRef.id }, {root: true})\r\n      return findById(rootState.threads.items, threadRef.id)\r\n    },\r\n    async updateThread ({ commit, state, rootState }, { title, text, id }) {\r\n      const thread = findById(state.items, id)\r\n      const post = findById(rootState.posts.items, thread.posts[0])\r\n      let newThread = { ...thread, title }\r\n      let newPost = { ...post, text }\r\n      const threadRef = doc(db, 'threads', id)\r\n      const postRef = doc(db, 'posts', post.id)\r\n      const batch = writeBatch(db)\r\n      batch.update(threadRef, newThread)\r\n      batch.update(postRef, newPost)\r\n      await batch.commit()\r\n      newThread = await getDoc(threadRef)\r\n      newPost = await getDoc(postRef)\r\n      commit('setItem', { resource: 'threads', item: newThread }, {root: true})\r\n      commit('setItem', { resource: 'posts', item: newPost }, {root: true})\r\n      return docToResource(newThread)\r\n    },\r\n    fetchThread: ({ dispatch }, { id }) => dispatch('fetchItem', { emoji: '📄', resource: 'threads', id }, {root: true}),\r\n    fetchThreads: ({ dispatch }, { ids }) => dispatch('fetchItems', { resource: 'threads', ids, emoji: '📄' }, {root: true}),\r\n  },\r\n  mutations: {\r\n    appendPostToThread: makeAppendChildToParentMutation({parent: 'threads', child: 'posts'}),\r\n    appendContributorToThread: makeAppendChildToParentMutation({ parent: 'threads', child: 'contributors' })\r\n  }\r\n}"]}]}